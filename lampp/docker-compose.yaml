services:

  lampp7apache:
    build: .
    container_name: lampp7apache
    ports:
      - ${APACHE_PORT}:80
    volumes:
      - ${APP_DIR}:/var/www/html
    depends_on:
      - lampp7db
    restart: unless-stopped
    mem_limit: 512m
    cpus: "0.75"
    networks:
      - presensi-net

  lampp7db:
    image: mysql:5.7
    container_name: lampp7db
    restart: unless-stopped
    command: --default-authentication-plugin=mysql_native_password
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
    volumes:
      - ${DB_DIR}:/var/lib/mysql
    ports:
      - ${MYSQL_PORT}:3306
    mem_limit: 1g
    cpus: "1.0"
    networks:
      - presensi-net

  lampp7phpmyadmin:
    image: phpmyadmin:5.2
    container_name: lampp7phpmyadmin
    restart: unless-stopped
    environment:
      PMA_HOST: lampp7db
    ports:
      - ${PHPMYADMIN_PORT}:80
    networks:
      - presensi-net

  db-backup:
    image: fradelg/mysql-cron-backup
    container_name: lampp7backup
    restart: unless-stopped
    environment:
      MYSQL_HOST: mysql
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASS: ${MYSQL_PASSWORD}
      MYSQL_DB: ${MYSQL_DATABASE}
      CRON_TIME: "0 1 * * *"
    volumes:
      - /root/backup/:/backup
    networks:
      - presensi-net

  cadvisor:
    image: gcr.io/cadvisor/cadvisor:latest
    container_name: lampp7cadvisor
    restart: unless-stopped
    ports:
      - 8085:8080
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:ro
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro
    privileged: true
    networks:
      - presensi-net

#  prometheus:
#    image: prom/prometheus
#    container_name: presensi_prometheus
#    restart: unless-stopped
#    volumes:
#      - ./monitoring/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
#    ports:
#      - 9090:9090
#    networks:
#      - presensi-net

#  grafana:
#    image: grafana/grafana-oss
#    container_name: presensi_grafana
#    restart: unless-stopped
#    ports:
#      - 3000:3000
#    volumes:
#      - grafana_data:/var/lib/grafana
#    networks:
#      - presensi-net

networks:
  presensi-net:
    driver: bridge

#volumes:
#  grafana_data:
